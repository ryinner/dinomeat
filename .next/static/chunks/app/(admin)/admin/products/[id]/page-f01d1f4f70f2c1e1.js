(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[713],{7973:function(e,t,n){Promise.resolve().then(n.bind(n,9141)),Promise.resolve().then(n.bind(n,171))},3981:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(7437);n(2265);var s=n(3913),c=n.n(s);function o(e){let{children:t,className:n,...s}=e,o="".concat(c().button," ").concat(null!=n?n:"");return(0,i.jsx)("button",{className:o,...s,children:t})}},9092:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(7437);n(2265);var s=n(1651),c=n.n(s);function o(e){let{children:t,inputAttrs:n,className:s,...o}=e,a="".concat(c().checkbox," ").concat(null!=s?s:"");return(0,i.jsxs)("label",{className:a,...o,children:[(0,i.jsx)("input",{type:"checkbox",className:c().checkbox__input,...n}),(0,i.jsx)("span",{className:c().checkbox__icon}),t]})}},3516:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var i=n(7437),s=n(7188),c=n(504),o=n(3178),a=n.n(o);function d(e){let{className:t,...n}=e,o="".concat(a().icon," ").concat(t);return(0,i.jsx)(c.G,{className:o,icon:s.Vui,...n})}},8004:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var i=n(7437),s=n(7188),c=n(504),o=n(3178),a=n.n(o);function d(e){let{className:t,...n}=e,o="".concat(a().icon," ").concat(t);return(0,i.jsx)(c.G,{className:o,icon:s.r6l,...n})}},9141:function(e,t,n){"use strict";n.r(t),n.d(t,{ProductsEdit:function(){return Y}});var i=n(7437),s=n(7814),c=n.n(s),o=n(2265),a=n(6673),d=n(7274),r=n.n(d),l=n(3516),u=n(8004),p=n(7922),m=n(504),h=n(3178),f=n.n(h);function x(e){let{className:t,...n}=e,s="".concat(f().icon," ").concat(t);return(0,i.jsx)(m.G,{className:s,icon:p.cf$,...n})}var g=n(418),v=n(4241),_=n(926),j=n(6691),b=n.n(j),y=n(1468),k=n.n(y);function N(e){let{id:t,image:n,onRemove:s,onUpload:c}=e,o=n instanceof File,[a,d]=(0,g.O)(o?"":n.image.alt),r=o?URL.createObjectURL(n):(0,_.G)(n.image.url);return(0,i.jsxs)("div",{className:k()["product-edit-images-item"],children:[(0,i.jsx)(b(),{width:200,height:150,alt:"",src:r}),(0,i.jsx)("input",{placeholder:"Alt",value:null!=a?a:"",onInput:function(e){e.target instanceof HTMLInputElement&&d(e.target.value)}}),(0,i.jsxs)("form",{className:k()["product-edit-images-item__controls"],children:[o?(0,i.jsx)(x,{onClick:function(){if(o){let e=new FormData;e.append("image",n),e.append("alt",null!=a?a:""),(0,v.r)("/api/admin/products/".concat(t,"/images"),{method:"POST",body:e},{withMessage:!0}).then(e=>{void 0!==c&&c(e.product.images),s(n)})}}}):(0,i.jsx)(u.Z,{onClick:function(){o||(0,v.r)("/api/admin/images/".concat(n.image.id),{method:"PUT",body:JSON.stringify({data:{alt:a}})},{withMessage:!0})}}),(0,i.jsx)(l.Z,{onClick:function(){o?s(n):(0,v.r)("/api/admin/images/".concat(n.image.id),{method:"DELETE",body:null},{withMessage:!0}).then(()=>s(n))}})]})]})}function I(e){let{id:t,images:n}=e,[s,c]=(0,o.useState)(n),[d,l]=(0,o.useState)([]),u=(0,o.useCallback)(e=>{e.forEach(e=>{let t=[];e.type.includes("image")&&void 0===d.find(t=>t.name===e.name)&&t.push(e),l(e=>[...e,...t])})},[d]);function p(e){l(t=>t.filter(t=>t.name!==e.name))}function m(e){c(t=>t.filter(t=>t.image.id!==e.image.id))}function h(e){c(e)}let{getRootProps:f,getInputProps:x,isDragActive:g}=(0,a.uI)({onDrop:u});return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{children:(0,i.jsxs)("form",{className:"".concat(r()["product-file-uploader"]," ").concat(g&&r()["product-file-uploader--drag-active"]),...f(),children:[(0,i.jsx)("input",{...x()}),(0,i.jsx)("p",{children:"Перенесите или кликнете для загрузки файлов"})]})}),(0,i.jsx)("div",{className:r()["product-file-uploaded-images"],children:(0,i.jsxs)("ul",{className:r()["product-file-uploaded-images__list"],children:[s.map(e=>(0,i.jsx)("li",{className:r()["product-file-uploaded-images__item"],children:(0,i.jsx)(N,{id:t,image:e,onRemove:m})},e.image.id)),d.map(e=>(0,i.jsx)("li",{className:r()["product-file-uploaded-images__item"],children:(0,i.jsx)(N,{id:t,image:e,onRemove:p,onUpload:h})},e.name))]})})]})}var C=n(3981),w=n(984),E=n(134),P=n(848);let S=[w.Z,P.Z],M=[2,3,4];function O(e){let{value:t,onInput:n}=e,s=(0,E.jE)({extensions:S,content:t,onUpdate:e=>{let{editor:t}=e;n instanceof Function&&n(t.getHTML())}});return(0,o.useEffect)(()=>{(null==s?void 0:s.getHTML().trim())!==t.trim()&&(null==s||s.commands.setContent(t))},[s,t]),(0,i.jsxs)(i.Fragment,{children:[s&&(0,i.jsx)(A,{editor:s}),(0,i.jsx)(E.kg,{editor:s})]})}function A(e){let{editor:t}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(E.AH,{editor:t,tippyOptions:{duration:100},children:[M.map(e=>(0,i.jsx)("button",{type:"button",onClick:()=>t.chain().focus().toggleHeading({level:e}).run(),className:t.isActive("heading",{level:e})?"is-active":"",children:"h".concat(e)},e)),(0,i.jsx)("button",{type:"button",onClick:()=>t.chain().focus().toggleBulletList().run(),className:t.isActive("bulletList")?"is-active":"",children:"* список"}),(0,i.jsx)("button",{type:"button",onClick:()=>t.chain().focus().toggleOrderedList().run(),className:t.isActive("bulletList")?"is-active":"",children:"1. список"})]}),(0,i.jsxs)(E.NM,{editor:t,tippyOptions:{duration:100},children:[(0,i.jsx)("button",{type:"button",onClick:()=>t.chain().focus().toggleBold().run(),className:t.isActive("bold")?"is-active":"",children:"bold"}),(0,i.jsx)("button",{type:"button",onClick:()=>t.chain().focus().toggleItalic().run(),className:t.isActive("italic")?"is-active":"",children:"italic"}),(0,i.jsx)("button",{type:"button",onClick:()=>t.chain().focus().toggleStrike().run(),className:t.isActive("strike")?"is-active":"",children:"strike"})]})]})}function T(e){let{empty:t=!1,children:n,...s}=e;return(0,i.jsxs)("select",{...s,children:[t&&(0,i.jsx)("option",{value:"",children:t}),n]})}function Z(e){let{className:t,...n}=e,s="".concat(f().icon," ").concat(null!=t?t:"");return(0,i.jsx)(m.G,{className:s,icon:p.BDt,...n})}function z(e,t,n){var i,s;let{target:c}=e,o=c.getAttribute("name"),a=null!==(i=c.getAttribute("type"))&&void 0!==i?i:"text";null!==o&&n(o,(s=c.value,"number"===a?Number(s):s))}var J=n(6970),L=n(8840),U=n.n(L);function H(e){var t;let{property:n,onUpdate:s}=e,c=null===(t=n.products.find(e=>e.valueId))||void 0===t?void 0:t.valueId;return(0,i.jsxs)("label",{children:[n.name,":",(0,i.jsx)(T,{value:c,onChange:function(e){if(e.target instanceof HTMLSelectElement){let{value:t}=e.target;s(n,t)}},empty:"Выберите характеристику",children:n.values.map(e=>(0,i.jsx)("option",{value:e.id,children:e.value},e.id))})]})}var G=n(9092),F=n(171),R=n(160),D=n.n(R);function B(e){let{size:t,product:n}=e,[s,c]=(0,g.O)(t),a=s.products.find(e=>e.productId===n.id),d=void 0!==a,[r,l]=(0,o.useState)(d?a.amount:0);return(0,i.jsxs)("div",{className:D().field,children:[(0,i.jsx)(G.Z,{className:D().field__checkbox,inputAttrs:{checked:d,onChange:function(e){e.target.checked?(0,v.r)("/api/admin/products/".concat(n.id,"/sizes"),{method:"POST",body:JSON.stringify({sizeId:s.id})},{withMessage:!0}).then(e=>{c(t=>({...t,products:[...t.products,e.relation]}))}):(0,v.r)("/api/admin/products-sizes/".concat(null==a?void 0:a.id),{method:"DELETE"},{withMessage:!0}).then(()=>{c({...s,products:[]})})}},children:s.name}),d&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{type:"number",placeholder:"Количество товара",defaultValue:r,onChange:function(e){l(Number(e.target.value))}}),(0,i.jsx)(u.Z,{onClick:function(){"number"==typeof r?(0,v.r)("/api/admin/products-sizes/".concat(null==a?void 0:a.id),{method:"PUT",body:JSON.stringify({amount:r})},{withMessage:!0}):(0,F.toast)("Количество продукта должно быть числом")}})]})]})}function V(e){var t,n,s,c,a;let{product:d,properties:r,sizes:l,categories:u}=e,[p,m]=(0,J.x)(d),[h,f]=(0,o.useState)(r);async function x(){let{slug:e}=await (0,v.r)("/api/admin/slug?text=".concat(p.name),{method:"GET"},{withMessage:!0});m(t=>{t.slug=e})}async function g(e){z(e,p,(e,t)=>{m(n=>{n[e]=t})})}async function _(e){e.preventDefault();let t=h.reduce((e,t)=>{var n,i;return(null===(n=t.products[0])||void 0===n?void 0:n.id)===void 0?"number"==typeof(null===(i=t.products[0])||void 0===i?void 0:i.valueId)&&(void 0===e.createMany&&(e.createMany={data:[]}),Array.isArray(e.createMany.data)&&e.createMany.data.push({valueId:t.products[0].valueId,propertyId:t.id})):void 0===t.products[0].valueId?(Array.isArray(e.delete)||(e.delete=[]),e.delete.push({id:t.products[0].id})):(Array.isArray(e.updateMany)||(e.updateMany=[]),e.updateMany.push({data:{valueId:t.products[0].valueId},where:{id:t.products[0].id}})),e},{});(0,v.r)("/api/admin/products/".concat(p.id),{method:"PUT",body:JSON.stringify({data:{...p,properties:t}})},{withMessage:!0}).then(e=>{f(e.product.properties)})}function j(e,t){f(n=>n.map(n=>{if(n.id===e.id){var i;return{...n,products:[{id:null===(i=e.products[0])||void 0===i?void 0:i.id,productId:p.id,propertyId:n.id,valueId:""===t?void 0:Number(t)}]}}return n}))}return(0,i.jsxs)("form",{onSubmit:_,children:[(0,i.jsxs)("div",{className:U()["product-edit-info"],children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("fieldset",{children:[(0,i.jsx)("legend",{children:"Базовая информация"}),(0,i.jsxs)("label",{children:["Название:",(0,i.jsx)("input",{name:"name",type:"text",value:p.name,onChange:g})]}),(0,i.jsxs)("label",{children:["Артикул:",(0,i.jsx)("input",{name:"article",type:"text",value:null!==(t=p.article)&&void 0!==t?t:"",onChange:g})]}),(0,i.jsxs)("label",{children:["Slug (Адрес):",(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{name:"slug",type:"text",disabled:p.published,value:null!==(n=p.slug)&&void 0!==n?n:"",onChange:g,style:{color:"#000",width:"calc(100% - 20px)"}}),!p.published&&(0,i.jsx)(Z,{onClick:x})]})]}),(0,i.jsxs)("label",{children:["Цена:",(0,i.jsx)("input",{name:"price",type:"number",value:null!==(s=p.price)&&void 0!==s?s:1,onChange:g})]}),(0,i.jsxs)("label",{children:["Категория:",(0,i.jsx)(T,{value:null!==(c=p.categoryId)&&void 0!==c?c:void 0,onChange:g,type:"number",name:"categoryId",empty:"Выберите категорию",children:u.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))})]})]}),(0,i.jsxs)("fieldset",{children:[(0,i.jsx)("legend",{children:"Наличие"}),l.map(e=>(0,i.jsx)(B,{product:p,size:e},e.id))]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("fieldset",{children:[(0,i.jsx)("legend",{children:"Размеры"}),(0,i.jsxs)("label",{children:["Вес (кг):",(0,i.jsx)("input",{name:"weight",type:"number",value:p.weight,onChange:g})]}),(0,i.jsxs)("label",{children:["Длина (см):",(0,i.jsx)("input",{name:"length",type:"number",value:p.length,onChange:g})]}),(0,i.jsxs)("label",{children:["Ширина (см):",(0,i.jsx)("input",{name:"width",type:"number",value:p.width,onChange:g})]}),(0,i.jsxs)("label",{children:["Высота (см):",(0,i.jsx)("input",{name:"height",type:"number",value:p.height,onChange:g})]})]}),(0,i.jsxs)("fieldset",{children:[(0,i.jsx)("legend",{children:"Характеристики"}),h.map(e=>(0,i.jsx)(H,{property:e,onUpdate:j},e.id))]})]})]}),(0,i.jsxs)("fieldset",{children:[(0,i.jsx)("legend",{children:"Описание"}),(0,i.jsx)(O,{value:null!==(a=p.description)&&void 0!==a?a:"",onInput:e=>{m(t=>{t.description=e})}})]}),(0,i.jsx)(C.Z,{type:"submit",children:"Сохранить"}),!p.published&&null!==p.slug&&p.slug.length>0&&(0,i.jsx)(C.Z,{type:"button",onClick:function(){(0,v.r)("/api/admin/products/".concat(p.id),{method:"PUT",body:JSON.stringify({data:{published:!0}})},{withMessage:!0}).then(()=>{m(e=>{e.published=!0})})},children:"Опубликовать"})]})}function W(e){var t,n;let{id:s,seo:c}=e,[o,a]=(0,J.x)(null!=c?c:{id:void 0,name:"",keywords:"",description:""});async function d(e){z(e,o,(e,t)=>{a(n=>{n[e]=t})})}async function r(e){e.preventDefault(),o.id?(0,v.r)("/api/admin/seo/".concat(o.id),{method:"PUT",body:JSON.stringify(o)},{withMessage:!0}):(0,v.r)("/api/admin/products/".concat(s),{method:"PUT",body:JSON.stringify({data:{seo:{create:{seo:{create:o}}}},select:{seo:{include:{seo:!0}}}})},{withMessage:!0}).then(e=>{a(t=>{t.id=e.product.seo[0].seo.id})})}return(0,i.jsxs)("form",{onSubmit:r,children:[(0,i.jsxs)("fieldset",{children:[(0,i.jsx)("legend",{children:"Seo базовая информация"}),(0,i.jsxs)("label",{children:["Название:",(0,i.jsx)("input",{name:"name",type:"text",value:o.name,onInput:d})]}),(0,i.jsxs)("label",{children:["Ключевые слова:",(0,i.jsx)("input",{name:"keywords",type:"text",value:null!==(t=o.keywords)&&void 0!==t?t:"",onInput:d})]})]}),(0,i.jsxs)("fieldset",{children:[(0,i.jsx)("legend",{children:"Seo описание"}),(0,i.jsx)(O,{value:null!==(n=o.description)&&void 0!==n?n:"",onInput:e=>{a(t=>{t.description=e})}})]}),(0,i.jsx)(C.Z,{type:"submit",children:"Сохранить"})]})}function Y(e){let{product:t,categories:n}=e,{seo:s,images:o,properties:a,sizes:d,...r}=t,[l]=s;return(0,i.jsxs)("div",{className:c().product,children:[(0,i.jsx)("div",{className:c().product__main,children:(0,i.jsx)(V,{product:r,properties:a,categories:n,sizes:d})}),(0,i.jsx)("div",{className:c().product__additional,children:(0,i.jsx)(W,{id:r.id,seo:null==l?void 0:l.seo})}),(0,i.jsx)("div",{className:c().product__images,children:(0,i.jsx)(I,{id:r.id,images:o})})]})}},418:function(e,t,n){"use strict";n.d(t,{O:function(){return s},R:function(){return c}});var i=n(2265);function s(e){let[t,n]=(0,i.useState)(e);return(0,i.useEffect)(()=>{n(()=>e)},[e]),[t,n]}function c(e,t){let[n,s]=(0,i.useState)(e),c=(0,i.useCallback)(e=>{e instanceof Function&&(e=e(n)),localStorage.setItem(t,JSON.stringify(e)),s(e)},[t,n]);return(0,i.useEffect)(()=>{try{var n;s(JSON.parse(null!==(n=localStorage.getItem(t))&&void 0!==n?n:""))}catch(t){s(e)}},[e,t]),[n,c]}},4241:function(e,t,n){"use strict";n.d(t,{W:function(){return s},r:function(){return c}});var i=n(171);async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(async(n,i)=>{e.includes("http")||(e="http://node.local"+e);try{let s=await fetch(e,t);s.ok?n(await s.json()):i(s)}catch(e){if(e instanceof Error&&"AbortError"!==e.name)throw e}})}async function c(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Promise(async(e,n)=>{let[c,o,a]=t;s(c,o).then(t=>{var n,s;null!==(n=null==a?void 0:a.withMessage)&&void 0!==n&&n&&(0,i.toast)(null!==(s=t.message)&&void 0!==s?s:"Успешно"),e(t)}).catch(async e=>{if(404===e.status);else{let t=await e.json();(0,i.toast)(t.message)}})})}},926:function(e,t,n){"use strict";function i(e){return"http://node.local"+e}n.d(t,{G:function(){return i}})},3913:function(e){e.exports={button:"Button_button__OFOdO"}},1651:function(e){e.exports={checkbox:"ControlsCheckbox_checkbox__x1qga",checkbox__input:"ControlsCheckbox_checkbox__input__zWwIN",checkbox__icon:"ControlsCheckbox_checkbox__icon__G6iSd"}},3178:function(e){e.exports={icon:"Icon_icon__goJ4H"}},7814:function(e){e.exports={product:"ProductsEdit_product__BPvci",product__main:"ProductsEdit_product__main__lwbPy",product__additional:"ProductsEdit_product__additional__7Mk7k",product__images:"ProductsEdit_product__images__ZmRHd"}},7274:function(e){e.exports={"product-file-uploader":"ProductsEditImages_product-file-uploader__ajY2T","product-file-uploader--drag-active":"ProductsEditImages_product-file-uploader--drag-active__YOz7l","product-file-uploaded-images":"ProductsEditImages_product-file-uploaded-images__hlaHi","product-file-uploaded-images__list":"ProductsEditImages_product-file-uploaded-images__list__ZGgfV"}},1468:function(e){e.exports={"product-edit-images-item":"ProductsEditImagesItem_product-edit-images-item___JsA5","product-edit-images-item__controls":"ProductsEditImagesItem_product-edit-images-item__controls__RM4yz"}},8840:function(e){e.exports={"product-edit-info":"ProductsEditProduct_product-edit-info__sQ6Kz"}},160:function(e){e.exports={field:"ProductsEditSizeItem_field__JRTxr",field__checkbox:"ProductsEditSizeItem_field__checkbox__WHE2x"}}},function(e){e.O(0,[676,572,691,893,937,971,472,744],function(){return e(e.s=7973)}),_N_E=e.O()}]);